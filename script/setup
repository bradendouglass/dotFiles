#!/bin/sh
# Dotfiles installer

SRCDIR="$HOME/src"
DOTFILES="$HOME/.dotfiles"
HOMESICK="$HOME/.homesick"
CONFIGDIR="$HOME/.config"
PREZTODIR="$HOME/.zprezto"
ASDFDIR="$HOME/.asdf"

# SRC Files for projects
if [[ ! -d "$SRCDIR" ]]; then
  mkdir "$SRCDIR"
fi

# Config Dir for NeoVim
if [[ ! -d "$CONFIGDIR" ]]; then
  curl -fLo ~/.config/nvim/autoload/plug.vim --create-dirs \
    https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
fi

# Change shell to zsh
if [[ ! -d "$PREZTODIR" ]]; then
  zsh && git clone --recursive https://github.com/sorin-ionescu/prezto.git "${ZDOTDIR:-$HOME}/.zprezto"
  setopt EXTENDED_GLOB
  for rcfile in "${ZDOTDIR:-$HOME}"/.zprezto/runcoms/^README.md; do
    ln -s "$rcfile" "${ZDOTDIR:-$HOME}/.${rcfile:t}"
  done
  chsh -s /bin/zsh
fi

# Build Dotfiles
cd "$DOTFILES"

sudo gem install homesick

homesick clone braidn/dotfiles
homesick symlink dotfiles

cd "$HOME"

# Keep Homesick dir but remove dotfiles dir
rm -rf "$DOTFILES"

# Hide Dock To Left
defaults write com.apple.dock pinning -string start \
&& write com.apple.dock static-only -bool TRUE \
&& write com.apple.dock autohide -bool TRUE \
&& defaults write com.apple.dock autohide-delay -float 100 \
&& defaults write com.apple.dock autohide-time-modifier -float 100 \
&& killall Dock

# Install ASDF

if [[ ! -d "$ASDFDIR" ]]; then
  git clone https://github.com/asdf-vm/asdf.git ~/.asdf
  cd ~/.asdf
  git checkout "$(git describe --abbrev=0 --tags)"

  cd "$HOME"
fi

# Add Support for Needed Languages

if [[ "$ASDFDIR" ]]; then
  asdf plugin-add crystal
  asdf plugin-add elixir
  asdf plugin-add erlang
  asdf plugin-add ruby
fi

# Install FNM for Node Support

curl -fsSL https://github.com/Schniz/fnm/raw/master/.ci/install.sh | bash

# Add Yarn support

curl -o- -L https://yarnpkg.com/install.sh | bash

# Install KR

curl https://krypt.co/kr | sh

# Install Vim Pluggin Manger

curl -fLo ~/.local/share/nvim/site/autoload/plug.vim --create-dirs \
  https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim

# Install Kitty Terminal Emulator

curl -L https://sw.kovidgoyal.net/kitty/installer.sh | sh /dev/stdin
